<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã€ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ç”¨ã€‘ãƒã‚±ãƒƒãƒˆç™»éŒ²</title>
  <style>
    body { font-family: sans-serif; padding: 15px; background: #f0f2f5; color: #333; }
    .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
    h1 { font-size: 1.1em; color: #2b6cb0; text-align: center; margin-bottom: 20px; }
    label { display: block; margin-top: 15px; font-weight: bold; font-size: 0.85em; }
    input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .price-notice { background: #fff5f5; color: #c53030; padding: 10px; border-radius: 5px; font-size: 0.8em; margin-top: 10px; font-weight: bold; text-align: center; }
    .total-display { margin-top: 20px; background: #fff9db; padding: 15px; border-radius: 10px; text-align: center; border: 2px solid #ffd43b; }
    #submit-btn { background: #3182ce; color: white; border: none; width: 100%; padding: 18px; margin-top: 20px; border-radius: 10px; font-weight: bold; font-size: 1.1em; cursor: pointer; }
    #submit-btn:disabled { background: #ccc; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="card">
    <h1 id="title-text">ğŸ« ãƒã‚±ãƒƒãƒˆç™»éŒ²</h1>
    
    <div id="day-price-info" class="price-notice" style="display:none;">âš ï¸ å½“æ—¥æ–™é‡‘ãŒé©ç”¨ã•ã‚Œã¦ã„ã¾ã™</div>

    <div id="name-area">
      <label>ãŠå®¢æ§˜ã®ãŠåå‰</label>
      <input type="text" id="cust-name" placeholder="å±±ç”° å¤ªéƒ">
    </div>

    <div class="grid">
      <div><label>Så¤§äºº</label><input type="number" id="sa" value="0" min="0" oninput="calc()"></div>
      <div><label>Så­ä¾›</label><input type="number" id="sc" value="0" min="0" oninput="calc()"></div>
      <div><label>èˆ¬å¤§äºº</label><input type="number" id="ga" value="0" min="0" oninput="calc()"></div>
      <div><label>èˆ¬å­ä¾›</label><input type="number" id="gc" value="0" min="0" oninput="calc()"></div>
    </div>

    <div id="status-area">
      <label>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
      <select id="status-select">
        <option value="å®Œäº†">å®Œäº†ï¼ˆå…¥é‡‘æ¸ˆã¿ãƒ»æ¸¡ã—æ¸ˆã¿ï¼‰</option>
        <option value="ã‚ªã‚­ãƒã‚±">ã‚ªã‚­ãƒã‚±ï¼ˆå…¥é‡‘æ¸ˆã¿ï¼‰</option>
        <option value="æœªå…¥é‡‘ã‚ªã‚­ãƒã‚±">æœªå…¥é‡‘ã‚ªã‚­ãƒã‚±</option>
      </select>
    </div>

    <label>å‚™è€ƒ</label>
    <textarea id="remarks-input" rows="2" placeholder="ãƒ¡ãƒ¢ãªã©ã‚ã‚Œã°"></textarea>

    <div class="total-display">
      åˆè¨ˆï¼š<span id="total-price" style="font-size: 1.6em; color: #d53f8c;">0</span> å††
    </div>

    <button id="submit-btn" onclick="sendData()">ç™»éŒ²ã™ã‚‹</button>
  </div>

  <script>
    const url = "https://script.google.com/macros/s/AKfycbxnk_cWoFkfFuo2rdHHFFW9qbxhAHwp62CTspQB_bJ_hAcOcDpXWm3lr030aNWioLOz0g/exec";
    const PERFORMANCE_DATE = new Date("2026-06-01T00:00:00");

    // èµ·å‹•æ™‚ã«å½“æ—¥ã‹äº‹å‰ã‹ã‚’åˆ¤å®šã—ã¦è¦‹ãŸç›®ã‚’å¤‰ãˆã‚‹
    function init() {
      const isDayPrice = new Date() >= PERFORMANCE_DATE;
      if (isDayPrice) {
        document.getElementById("title-text").innerText = "ğŸ« å½“æ—¥åˆ¸ è²©å£²ãƒ•ã‚©ãƒ¼ãƒ ";
        document.getElementById("day-price-info").style.display = "block";
        document.getElementById("name-area").classList.add("hidden");
        document.getElementById("status-area").classList.add("hidden");
      } else {
        document.getElementById("title-text").innerText = "ğŸ« äº‹å‰æ‰‹å…ƒè²©å£² ç™»éŒ²";
      }
      calc();
    }

    function calc() {
      const sa = Number(document.getElementById("sa").value) || 0;
      const sc = Number(document.getElementById("sc").value) || 0;
      const ga = Number(document.getElementById("ga").value) || 0;
      const gc = Number(document.getElementById("gc").value) || 0;

      const isDayPrice = new Date() >= PERFORMANCE_DATE;
      const add = isDayPrice ? 500 : 0;

      const total = (sa * (3500 + add)) + (sc* 0) + (ga * (2000 + add)) + (gc * 0);
      document.getElementById("total-price").innerText = total.toLocaleString();
    }

    async function sendData() {
      const isDayPrice = new Date() >= PERFORMANCE_DATE;
      
      // å½“æ—¥è²©å£²ãªã‚‰ã€Œå½“æ—¥è²©å£²ã€ã€äº‹å‰ãªã‚‰å…¥åŠ›ã•ã‚ŒãŸåå‰
      let name = isDayPrice ? "å½“æ—¥è²©å£²" : document.getElementById("cust-name").value;
      if(!name) return alert("ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

      if(!confirm(name + " ã¨ã—ã¦ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ")) return;

      const btn = document.getElementById("submit-btn");
      btn.disabled = true;
      btn.innerText = "ç™»éŒ²ä¸­...";

      const payload = {
        type: "addDirectSale",
        name: name,
        s_a: document.getElementById("sa").value,
        s_c: document.getElementById("sc").value,
        g_a: document.getElementById("ga").value,
        g_c: document.getElementById("gc").value,
        total: document.getElementById("total-price").innerText.replace(/,/g, ''),
        shipping: "æ‰‹æ¸¡ã—",
        salesType: isDayPrice ? "å½“æ—¥è²©å£²" : "ç›´æ¥è²©å£²", // Påˆ—ç”¨
        remarks: document.getElementById("remarks-input").value, // Wåˆ—ç”¨
        status: isDayPrice ? "å®Œäº†" : document.getElementById("status-select").value
      };

      try {
        await fetch(url, { method: "POST", body: JSON.stringify(payload) });
        alert("ç™»éŒ²å®Œäº†ï¼");
        location.reload();
      } catch (e) {
        alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
        btn.disabled = false;
        btn.innerText = "ç™»éŒ²ã™ã‚‹";
      }
    }

    window.onload = init;
  </script>
</body>
</html>